extends default_web_logged-in_layout.pug

block styles
    link(rel="stylesheet", href="/css/payment.css")

block content
    .payment-container
        h2 Payment
        p Total Amount: Â£#{totalAmount ? totalAmount.toFixed(2) : '0.00'}

        form(action="/process-payment", method="POST")
            input(type="hidden", name="transactionId", value="#{transactionId}")
            input(type="hidden", name="userId", value="#{activeUser.userID}")
            input(type="hidden", name="totalAmount", value="#{totalAmount}")

            .form-group
                label(for="paymentType") Payment Method:
                select(name="paymentType", id="paymentType", required)
                    option(value="") Select Payment Method
                    option(value="card") Card Payment
                    option(value="bank") Bank Transfer

            #card-details(style="display: none;")
                h3 Card Payment
                .form-group
                    label(for="cardNumber") Card Number:
                    input(type="text", id="cardNumber", name="cardNumber", pattern="\d+", title="Card number should contain only digits")
                .form-group
                    label(for="expiryMonth") Expiry Date (MM/YY):
                    input(type="text", id="expiryMonth", name="expiryMonth", placeholder="MM", pattern="\d{2}", title="Enter month in MM format")
                    input(type="text", id="expiryYear", name="expiryYear", placeholder="YY", pattern="\d{2}", title="Enter year in YY format")
                .form-group
                    label(for="cvv") CVV:
                    input(type="text", id="cvv", name="cvv", pattern="\d{3}", title="CVV should be 3 digits")

            #bank-details(style="display: none;")
                h3 Bank Transfer
                .form-group
                    label(for="accountNumber") Account Number (8 digits):
                    input(type="text", id="accountNumber", name="accountNumber", pattern="\d{8}", title="Account number should be 8 digits")
                .form-group
                    label(for="sortCode") Sort Code (6 digits):
                    input(type="text", id="sortCode", name="sortCode", pattern="\d{6}", title="Sort code should be 6 digits")

            button(type="submit") Process Payment

        script.
            const paymentTypeSelect = document.getElementById('paymentType');
            const cardDetails = document.getElementById('card-details');
            const bankDetails = document.getElementById('bank-details');

            paymentTypeSelect.addEventListener('change', function() {
                cardDetails.style.display = this.value === 'card' ? 'block' : 'none';
                bankDetails.style.display = this.value === 'bank' ? 'block' : 'none';
                // Optionally clear fields when switching
                if (this.value !== 'card') clearCardFields();
                if (this.value !== 'bank') clearBankFields();
            });

            function clearCardFields() {
                document.getElementById('cardNumber').value = '';
                document.getElementById('expiryMonth').value = '';
                document.getElementById('expiryYear').value = '';
                document.getElementById('cvv').value = '';
            }

            function clearBankFields() {
                document.getElementById('accountNumber').value = '';
                document.getElementById('sortCode').value = '';
            }